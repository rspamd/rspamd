# Config for metadata_exporter structured formatter functional tests
.include(duplicate=append,priority=0) "{= env.TESTDIR =}/configs/plugins.conf"

lua = "{= env.LUA_SCRIPT =}";
redis {
  servers = "{= env.REDIS_ADDR =}:{= env.REDIS_PORT =}";
}

# Configure metadata_exporter with structured formatter and redis_stream backend
metadata_exporter {
  rules {
    STRUCTURED_EXPORT {
      backend = "redis_stream";
      formatter = "structured";
      stream_key = "test:structured";
      max_len = 100;
      selector = "default";
    }
    STRUCTURED_EXPORT_ZSTD {
      backend = "redis_stream";
      formatter = "structured";
      zstd_compress = true;
      stream_key = "test:structured_zstd";
      max_len = 100;
      selector = "default";
    }
  }
}
